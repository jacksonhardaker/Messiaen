var messiaen=messiaen?messiaen:{};messiaen.audio=function(e){var i={},n=[],a=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","Bb","B"],t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=[],s=100,d=[],r=!1;i.initialise=function(){for(var e="Audio/Mp3/",i=".mp3",o=0;5>o;o++)for(var r=0;12>r;r++)n.push({pitch:a[r],audio:e+t[r]+"/"+(o+1)+i,id:a[r]+(o+1),loaded:!1});for(var l=0;s>l;l++){var c=[];c.channel=new Audio,c.finished=-1,d.push(c)}},i.loadPitch=function(e){for(var i=0;i<n.length;i++){var a=n[i];if(a.pitch===e&&!a.loaded){var t=document.createElement("audio");t.setAttribute("preload","auto"),t.setAttribute("id",a.id),t.setAttribute("src",a.audio),document.body.appendChild(t),n[i].loaded=!0}}};var l=[],c=function(){for(var e=document.getElementById(o[0]),i=0;s>i;i++){var n=new Date;if(d[i].finished<n.getTime()){d[i].finished=n.getTime()+1e3*e.duration,d[i].channel.src=e.src,d[i].channel.load(),d[i].channel.play();break}}l.push(o[0]),o.splice(0,1),o.length>0?setTimeout(c,150):setTimeout(h,900)},h=function(){for(var i=document.getElementById(l[0]),n=0;s>n;n++){var a=new Date;if(d[n].finished<a.getTime()){d[n].finished=a.getTime()+1e3*i.duration,d[n].channel.src=i.src,d[n].channel.load(),d[n].channel.play();break}}l.splice(0,1),l.length>0?h():(r=!1,e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none"))};i.playChord=function(e){if(e.length>0&&!r){r=!0;for(var i=[],a=0,t=!1,o=0;o<e.length;o++){var s=e[o];t=!1;for(var d=a;d<n.length;d++)if(n[d].pitch===s){n[d].loaded===!1&&messiaen.audio.loadPitch(s),i.push(n[d].id),a=d,t=!0;break}if(!t)for(var l=a;l>=0;l--)if(n[l].pitch===s){n[l].loaded===!1&&messiaen.audio.loadPitch(s),i.push(n[l].id),a=l,t=!0;break}}u(i)}};var u=function(i){if(i&&0!==i.length){e(e("#playMessiaenChordButton").children()[0]).css("display","none"),e(e("#playMessiaenChordButton").children()[1]).css("display","block");for(var n=!0,a=0,t=i.length;t>a;a++)if(!document.getElementById(i[a]).readyState){n=!1;break}if(n){for(var s=0;s<i.length;s++)o.push(i[s]);c()}else setTimeout(function(){u(i)},100)}else e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none")};return i}(jQuery);