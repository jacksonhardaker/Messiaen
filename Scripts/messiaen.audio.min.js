messiaen.audio=function(e){var i={},n=[],a=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","Bb","B"],t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=[],d=100,r=[],s=!1;i.initialise=function(){for(var e="Audio/Mp3/",i=".mp3",o=0;5>o;o++)for(var s=0;12>s;s++)n.push({pitch:a[s],audio:e+t[s]+"/"+(o+1)+i,id:a[s]+(o+1),loaded:!1});for(var l=0;d>l;l++){var c=[];c.channel=new Audio,c.finished=-1,r.push(c)}},i.loadPitch=function(e){for(var i=0;i<n.length;i++){var a=n[i];if(a.pitch===e&&!a.loaded){var t=document.createElement("audio");t.setAttribute("preload","auto"),t.setAttribute("id",a.id),t.setAttribute("src",a.audio),document.body.appendChild(t),n[i].loaded=!0}}};var l=[],c=function(){for(var e=document.getElementById(o[0]),i=0;d>i;i++){var n=new Date;if(r[i].finished<n.getTime()){r[i].finished=n.getTime()+1e3*e.duration,r[i].channel.src=e.src,r[i].channel.load(),r[i].channel.play();break}}l.push(o[0]),o.splice(0,1),o.length>0?setTimeout(c,150):setTimeout(h,900)},h=function(){for(var i=document.getElementById(l[0]),n=0;d>n;n++){var a=new Date;if(r[n].finished<a.getTime()){r[n].finished=a.getTime()+1e3*i.duration,r[n].channel.src=i.src,r[n].channel.load(),r[n].channel.play();break}}l.splice(0,1),l.length>0?h():(s=!1,e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none"))};i.playChord=function(e){if(e.length>0&&!s){s=!0;for(var i=[],a=0,t=!1,o=0;o<e.length;o++){var d=e[o];t=!1;for(var r=a;r<n.length;r++)if(n[r].pitch===d){n[r].loaded===!1&&messiaen.audio.loadPitch(d),i.push(n[r].id),a=r,t=!0;break}if(!t)for(var l=a;l>=0;l--)if(n[l].pitch===d){n[l].loaded===!1&&messiaen.audio.loadPitch(d),i.push(n[l].id),a=l,t=!0;break}}u(i)}};var u=function(i){if(i&&0!==i.length){e(e("#playMessiaenChordButton").children()[0]).css("display","none"),e(e("#playMessiaenChordButton").children()[1]).css("display","block");for(var n=!0,a=0,t=i.length;t>a;a++)if(!document.getElementById(i[a]).readyState){n=!1;break}if(n){for(var d=0;d<i.length;d++)o.push(i[d]);c()}else setTimeout(function(){u(i)},100)}else e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none")};return i}(jQuery);