messiaen.audio=function(e){var n={},a=[],i=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","Bb","B"],t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=[],d=100,r=[],l=!1;n.initialise=function(){for(var e="Audio/Mp3/",n=".mp3",o=0;5>o;o++)for(var l=0;12>l;l++)a.push({pitch:i[l],audio:e+t[l]+"/"+(o+1)+n,id:i[l]+(o+1),loaded:!1});for(var s=0;d>s;s++){var c=[];c.channel=new Audio,c.finished=-1,r.push(c)}},n.loadPitch=function(e){for(var n=0;n<a.length;n++){var i=a[n];if(i.pitch===e&&!i.loaded){var t=document.createElement("audio");t.setAttribute("preload","auto"),t.setAttribute("id",i.id),t.setAttribute("src",i.audio),document.body.appendChild(t),a[n].loaded=!0}}};var s=[],c=function(){for(var e=document.getElementById(o[0]),n=0;d>n;n++){var a=new Date;if(r[n].finished<a.getTime()){r[n].finished=a.getTime()+1e3*e.duration,r[n].channel.src=e.src,r[n].channel.load(),r[n].channel.play();break}}s.push(o[0]),o.splice(0,1),o.length>0?setTimeout(c,150):setTimeout(h,900)},h=function(){for(var n=document.getElementById(s[0]),a=0;d>a;a++){var i=new Date;if(r[a].channel<i.getTime()){r[a].channel=i.getTime()+1e3*n.duration,r[a].channel.src=n.src,r[a].channel.load(),r[a].channel.play();break}}s.splice(0,1),s.length>0?h():(l=!1,e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none"))};n.playChord=function(e){if(e.length>0&&!l){l=!0;for(var n=[],i=0,t=!1,o=0;o<e.length;o++){var d=e[o];t=!1;for(var r=i;r<a.length;r++)if(a[r].pitch===d){a[r].loaded===!1&&messiaen.audio.loadPitch(d),n.push(a[r].id),i=r,t=!0;break}if(!t)for(var s=i;s>=0;s--)if(a[s].pitch===d){a[s].loaded===!1&&messiaen.audio.loadPitch(d),n.push(a[s].id),i=s,t=!0;break}}u(n)}};var u=function(n){if(n&&0!==n.length){e(e("#playMessiaenChordButton").children()[0]).css("display","none"),e(e("#playMessiaenChordButton").children()[1]).css("display","block");for(var a=!0,i=0,t=n.length;t>i;i++)if(!document.getElementById(n[i]).readyState){a=!1;break}if(a){for(var d=0;d<n.length;d++)o.push(n[d]);c()}else setTimeout(function(){u(n)},100)}else e(e("#playMessiaenChordButton").children()[0]).css("display","block"),e(e("#playMessiaenChordButton").children()[1]).css("display","none")};return n}(jQuery);